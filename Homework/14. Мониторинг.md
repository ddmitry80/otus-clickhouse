# Мониторинг

##  Вариант 2: Prometheus/Grafana

Использованые ресурсы:
- https://www.dmosk.ru/miniinstruktions.php?mini=prometheus-stack-docker
- https://clickhouse.com/docs/integrations/prometheus

В контейнеры с хостами проброшен конфиг для сбора метрик: `configs/prometheus_ch.xml`. Проверяем работу локальных метрик
```sh
curl -s localhost:9126/metrics 2>/dev/null | grep -v '^#' | head

ClickHouseProfileEvents_Query 29
ClickHouseProfileEvents_SelectQuery 23
ClickHouseProfileEvents_InsertQuery 1
ClickHouseProfileEvents_InitialQuery 27
ClickHouseProfileEvents_QueriesWithSubqueries 50
ClickHouseProfileEvents_SelectQueriesWithSubqueries 45
ClickHouseProfileEvents_InsertQueriesWithSubqueries 0
ClickHouseProfileEvents_SelectQueriesWithPrimaryKeyUsage 0
ClickHouseProfileEvents_AsyncInsertQuery 0
ClickHouseProfileEvents_AsyncInsertBytes 0
```

Запускаем в контейнере Prometheus, конфиг пробрасываем `configs/prometheus.yml`

В соседнем контейнере - Grafana. За осонову взят дашборд 14192, он же сохранен в репозитории как `grafana_14192_rev4.json`


Скрин экрана: ![Скриншот](img/14.%20Screenshot%2001.png)

Больше информации в файле `README.md` каталога `sharded_cluster`
